(()=>{var e,t;(()=>{const e=lodash,{api:t,util:a,priceFormat:r,dateFormat:n}=window.wteL10n;class i{constructor(e){var i,o=this;this.bookingform=e,this.summaryTemplate=wp.template("wte-booking-summary"),this.datetimeTemplate=wp.template("wte-booking-datetime"),this.state={selectedPackage:null,selectedDate:n(null),selectedTime:n(null),packageCategories:{},travelerRecord:{},availablePackages:[],availableTimes:[],extraServices:{},loading:!0,defaultDateFormat:"YYYY-MM-DD",cart:{},formatPrice:function(e){var t;const{currency:a,baseCurrency:r,currencySymbol:n,format:{number:i,price:o}}=wteL10n;let l={[r]:1};if("undefined"!=typeof wteCc&&null!==(t=wteCc)&&void 0!==t&&t.code)for(let e in wteCc.code)l={...l,[wteCc.code[e]]:wteCc.rate[e]};return e*=+l[a],wteL10n.helpers.priceFormat(e,a,n,o,+i.decimal,i.decimalSeparator,i.thousandSeparator)},groupPricings:{},cartTotal:{travelers:0}},this.extraServicesAPI=(i=this,()=>{let e=i._store,{trip:t}=e.getState();if(t.trip_extras.length<1)return;document.getElementById("wte-booking-extraservices-content").innerHTML=wp.template("wte-booking-extraservices")(),e.subscribe((()=>{let t=e.getState().services||{},a="";for(let r in t){let n=t[r],i=null==n?void 0:n.meta.wte_services.service_type;a+=wp.template(`wte-booking-es-${i}`)({service:n,extraServices:e.getState().extraServices})}document.getElementById("wte-booking-extraservices__services").innerHTML=a,document.getElementById("wte-booking-es-summary-content").innerHTML=wp.template("wte-booking-es-summary")(e.getState())})),e.dispatch(((a,r)=>{var n;fetch(`${wteL10n.wpapi.root}${wteL10n.wpapi.versionString}wte-services?include=${null===(n=t.trip_extras)||void 0===n?void 0:n.join(",")}`).then((t=>{t.json().then((t=>{t&&e.dispatch({type:"UPDATE_STORE",data:{services:lodash.keyBy(t,"id")}})}))}))}));const r=function(t){var a,r;let n=this,i=n.closest(".wte-booking-es-counter").dataset.info;i=i&&JSON.parse(i);let{serviceID:o,option:l}=i,s={[l]:1},c=0;if(n.classList.contains("wte-up"))c=1;else{if(!n.classList.contains("wte-down"))return;c=-1}let{extraServices:d,services:u,cartTotal:p,cart:f}=e.getState(),v=c>0?1:0;if(d[o]&&(v=c>0?d[o][l]?+d[o][l].count+1:1:d[o][l]?+d[o][l].count-1:0),v<0)return;let m=u[o]||{},g=null!==(a=null==m||null===(r=m.meta)||void 0===r?void 0:r.wte_services)&&void 0!==a?a:{},w=0,h="",b="unit";null!=g&&g.service_type&&("custom"===g.service_type?(h=g.options[l],w=+g.prices[l],b=g.service_unit):(h=m.title.rendered,w=+g.service_cost,b=g.service_unit)),s={...d[o],[l]:{count:v<0?0:v,unitPrice:w,label:h,per:b}};let y={...d,[o]:s},_=0,k=[];for(let e in y){let t=y[e];for(let e in t){let a=t[e];_+=+a.count*+a.unitPrice,+a.count>0&&(k=[...k,{extra_service:a.label,qty:a.count,price:+a.unitPrice}])}}f={...f,extraServices:k},e.dispatch({type:"UPDATE_STORE",data:{extraServices:y,cartTotal:{...p,services:_},cart:f}})};a.on("change",".wte-booking-es-select",(function(t){let a=this,r=a.dataset.info;r=r&&JSON.parse(r);let{extraServices:n,services:i}=e.getState(),{serviceID:o,option:l}=r,{options:s,service_unit:c,prices:d}=i[o].meta.wte_services,u={};u={...n,[o]:{[a.value]:{count:0,label:s[a.value],per:c,unitPrice:d[a.value]}}},e.dispatch({type:"UPDATE_STORE",data:{extraServices:u}})})),a.on("click",".wte-booking-es-counter .wte-up",r),a.on("click",".wte-booking-es-counter .wte-down",r)}),this._store=Redux.createStore((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.state,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TRIP":return{...e,trip:t.data};case"UPDATE_STORE":return{...e,...t.data};case"SET_DATE":return{...e,selectedDate:t.date};case"SET_TIME":return{...e,selectedTime:t.data};case"SET_PACKAGE":return{...e,selectedPackage:t.data};case"SET_TRAVELER_RECORD":return{...e,travelerRecord:t.data};default:return e}}),Redux.applyMiddleware((e=>t=>a=>"function"==typeof a?a(e.dispatch,e.getState):t(a)))),this.unsubscriber=this._store.subscribe((()=>{!this._store.getState().loading&&this._store.getState().trip&&(console.info("Initialize Booking Process",this._store.getState()),this.init())})),this._store.subscribe((()=>{this.updateSelectedTime(),this.updateSummary(),this.updatePackageTabContent()})),this._store.dispatch((async(e,a)=>{var r;let n=await t.get("trip",{id:wte.trip.id}),i=null!==(r=n.packages_ids)&&void 0!==r?r:[],o=[];try{if(!i)throw new Error(`No packages assigned to this trip - ${n.id}`);o=await t.get("packages",{include:i.join(","),per_page:100})}catch(e){console.warn("WTEBOOKING: "+e.message)}let l=await t.get("categories");e({type:"UPDATE_STORE",data:{loading:!1,trip:n,tripPackagesIds:i,tripPackages:o,pricingCategories:l,primaryCategory:Object.values(l).find((e=>e["is-primary"]))}})})),this.priceFormat=function(e){return r(e)},this.cart={},this.currentTab=0,this.tabController={},this.timeformat="h:mm A",this.timeformatter=e=>(wteL10n.format.datetime.timezone,moment(e).format(this.timeformat)),this.addToCart=()=>{var e,t;const{wpxhr:{root:a},tripID:r,_nonces:{addtocart:n}}=wteL10n;let{cart:i,selectedPackage:o,selectedDate:l,selectedTime:s,travelerRecord:c,cartTotal:d,packageCategories:u,groupPricings:p,trip:f}=this._store.getState();var v,m,g,w,h,b;if(""!=f.min_pax&&+f.min_pax>i.traveler)return void alert(null===(v=wteL10n)||void 0===v||null===(m=v.l10n)||void 0===m||null===(g=m.invalidCartTraveler)||void 0===g?void 0:g.replace("%s",f.min_pax));if(null===(e=i)||void 0===e||!e.traveler||i.traveler<1)return void alert(null===(w=wteL10n)||void 0===w||null===(h=w.l10n)||void 0===h||null===(b=h.invalidCartTraveler)||void 0===b?void 0:b.replace("%s",1));wteL10n.format.datetime.GMTOffset;let y=o,_=l.format("YYYY-MM-DD"),k=s.get()?s.format("YYYY-MM-DDTHH:mm"):"",T=c,x={};d=Object.values(d).reduce((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return+e+ +t}));for(let e in T){let t=T[e];if(t<1)continue;let a=u[e],r={pax:t,salePrice:null!=a&&a.salePrice?+a.salePrice:0,groupDiscountPrice:0,cost:+a.price};if(a.enabledSale&&(r.cost=a.salePrice),a.enabledGroupDiscount&&p&&p[e])for(let n of p[e]){if(n.to.length<1){r.cost=n.price.length>0?+n.price:+a.price;break}if(t>=+n.from&&t<=+n.to){r.cost=n.price.length>0?+n.price:+a.price;break}}r.categoryInfo=a,x={...x,[e]:r}}i={...i,nonce:n,tripID:r,packageID:y,tripDate:_,tripTime:k,travelers:T,cartTotal:d,pricingOptions:x,cversion:(null===(t=wteL10n)||void 0===t?void 0:t.cart_version)||"2.0"},fetch(`${a}?action=wte_add_trip_to_cart&cart_version=${i.cversion}&_nonce=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((e=>e.json().then((e=>{var t,a;e.success?window.location.href=null===(t=window)||void 0===t||null===(a=t.wp_travel_engine)||void 0===a?void 0:a.CheckoutURL:e.data&&e.data[0]&&alert(e.data[0])}))))}}init(){this.unsubscriber(),this.loadTemplates(),this.initTabController(),this.initCalendar(),this.eventListeners(),this.bookingProcessFlowControl()}initTabController(){var e=this;let t=this.bookingform.querySelectorAll(".wte-process-nav-item"),r=this.bookingform.querySelectorAll(".wte-process-tab-item");var n;this.tabController={tabCount:null==t?void 0:t.length,navigators:t,activeTab:"wte-booking-datetime",activeClass:"active",completedClass:"finish",nextBtn:"#wteProcessNext",prevBtn:"#wteProcessPrev",toggleNextBtn:function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a=document.querySelector(e.nextBtn);a&&(a.disabled=t)},finalAction:(n=this,function(){n.addToCart()}),validToNextProcess:(e=>function(){let t=e.tabController,a=document.querySelector(t.nextBtn);switch(t.activeTab){case"wte-booking-datetime":const{selectedDate:t,availableTimes:r,selectedTime:n}=e._store.getState();return t&&(null==t?void 0:t.get())&&(Object.keys(r).length<1||Object.keys(r).length&&(null==n?void 0:n.get()));case"wte-booking-packages":const{cart:i}=e._store.getState();return null!=i&&i.traveler&&i.traveler>0?(a.disabled=!1,!0):(a.disabled=!0,!1);default:return!0}})(this),switchBtnText:function(){let e=WTEBooking.tabController,t=document.querySelector(e.nextBtn);e.getActiveTabIndex()>=e.tabCount-1?t.textContent=t.dataset.labelCheckout||"Add to Cart":t.textContent=t.dataset.labelDefault||"Continue"},getActiveTabIndex:function(){let e=document.getElementById(this.activeTab);return Array.prototype.indexOf.call(r,e)},handleProcessBtnClick:function(e){let t=WTEBooking.tabController;if(this.matches(t.prevBtn))t.activeTab=r[t.getActiveTabIndex()-1].id;else if(this.matches(t.nextBtn)){let e=t.getActiveTabIndex()+1;if(e>=t.tabCount)t.finalAction();else{let a=r[e].id;t.validToNextProcess()&&(t.activeTab=a)}}t.switchBtnText(),t.getActiveTabIndex()>0?document.querySelector(t.prevBtn).style.removeProperty("display"):document.querySelector(t.prevBtn).style.display="none",t.showActiveTab()},init:function(){let e=this;e.showActiveTab();let t=+e.getActiveTabIndex();t<1&&(document.querySelector(e.prevBtn).style.display="none"),document.querySelector(".wte-process-nav-list").style.setProperty("--step-bar-width",(t+1)/3*100+"%"),a.on("click",e.nextBtn,e.handleProcessBtnClick),a.on("click",e.prevBtn,e.handleProcessBtnClick)},showActiveTab:function(){let e=this,t=+e.getActiveTabIndex();if(t<0)t=0;else if(t>=e.tabCount)t=e.tabCount-1;else{document.querySelector(".wte-process-nav-list").style.setProperty("--step-bar-width",(t+1)/3*100+"%");for(let a in Array.from(e.navigators)){let n=e.navigators[a];if(a<=t){if(a<t?n.classList.add(e.completedClass):n.classList.add(e.activeClass),a==t){for(let e in Array.from(r))r[e].style.removeProperty("display");document.querySelector("a"===n.tagName.toLowerCase()?n.hash:n.dataset.target).style.display="block"}}else n.classList.remove(e.activeClass,e.completedClass)}}}},this.tabController.init()}getJSONData(){return{trip:this.trip,tripPackages:this.tripPackages,availablePackages:this.availablePackages,selectedPackage:this.selectedPackage,packageCategories:this.getPackageCategories(this.selectedPackage),travelerRecord:this.travelerRecord,groupPricings:this.selectedPackage?this.tripPackages[this.selectedPackage]["group-pricing"]:{},formatPrice:this.formatPrice,selectedDate:this.selectedDate,cartTotal:this.calculateCartTotal(),selectedTime:this.selectedTime,availableTimes:this.availableTimes,extraServices:this.extraServices}}loadTemplates(){document.getElementById("wte-booking-datetime-content").innerHTML=this.datetimeTemplate(this._store.getState()),document.getElementById("wte-booking-packages-content").innerHTML=wp.template("wte-booking-packages")(this._store.getState()),document.getElementById("wte-booking-summary").innerHTML=wp.template("wte-booking-summary")(this._store.getState()),document.dispatchEvent(new Event("wteLoadBookingTemplates"))}calculateCartTotal(){let e=this.travelerRecord,t=0;for(let r in e){let n=e[r],i=this.getPackageCategories(this.selectedPackage)[r],o=i.enabledSale?+i.salePrice:+i.price,l=this.selectedPackage?this.tripPackages[this.selectedPackage]["group-pricing"]:{};if(Object.keys(l).length>0&&l[r]){var a=l[r];for(let e of a){if(e.to.length<1){o=e.price||o;break}if(+n>=+e.from&&+n<=+e.to){o=e.price;break}}}t+=o*+n}return t}eventListeners(){var e;a.on("click",".wte-package-select-btn",(e=this,function(t){let a=this.dataset.packageId,{tripPackages:r}=e._store.getState();const n=e.getDefaultCart(a);e._store.dispatch({type:"UPDATE_STORE",data:{selectedPackage:a,packageCategories:e.getPackageCategories(a),groupPricings:a?r[a]["group-pricing"]:{},...n}})}));const t=e=>function(t){var a;let r=this,n=0;if(r.classList.contains("wte-up"))n=1;else{if(!r.classList.contains("wte-down"))return;n=-1}let{travelerRecord:i,cart:o,cartTotal:l,packageCategories:s,tripPackages:c,selectedPackage:d,trip:u,selectedTime:p,selectedDate:f,parentDateConfig:v}=e._store.getState(),m={...o},g={...i},w=r.parentElement.dataset.info;w=w&&JSON.parse(w);const h=w.catID;if(g[h]<1&&n<0)return;let b=0;if(n>0?(b=g[h]?+g[h]+1:1,m.traveler=null!=m&&m.traveler?+m.traveler+1:1):(b=g[h]&&g[h]>=1?+g[h]-1:0,m.traveler=null!=m&&m.traveler?+m.traveler-1:0),b<0)return;let y=s[h].minPax;y&&b<y&&(m.traveler=m.traveler-n*(1-y),b=n<0?0:y);let _=s[h].maxPax;var k,T,x;if(_&&b>_&&(m.traveler=m.traveler-1,b=_),""!=u.max_pax&&+u.max_pax<m.traveler)return void alert(null===(k=wteL10n)||void 0===k||null===(T=k.l10n)||void 0===T||null===(x=T.availableSeatsExceed)||void 0===x?void 0:x.replace("%s",u.max_pax));let C=-1;if(p.get()){let e=p.format("YYYY-MM-DD-HH-mm-ss").split("-");e[1]=e[1]-1,C=.001*new Date(Date.UTC(...e)).getTime()}else if(null!=f&&f.get()){let e=f.format("YYYY-MM-DD").split("-");e[1]=e[1]-1,C=.001*new Date(Date.UTC(...e)).getTime()}if(v&&u["booked-seats"]&&u["booked-seats"][C]&&parseInt(null===(a=u["booked-seats"][C])||void 0===a?void 0:a.booked)){const e=v&&null!=v&&v._seats?parseInt(v._seats)-parseInt(u["booked-seats"][C].booked):-1;var S,D,P;if(""!==v._seats&&e>-1&&e<m.traveler)return void alert(null===(S=wteL10n)||void 0===S||null===(D=S.l10n)||void 0===D||null===(P=D.availableSeatsExceed)||void 0===P?void 0:P.replace("%s",e))}else if(v){var E,L,j;if(parseInt(v._seats)<+m.traveler)return void alert(null===(E=wteL10n)||void 0===E||null===(L=E.l10n)||void 0===L||null===(j=L.availableSeatsExceed)||void 0===j?void 0:j.replace("%s",v._seats))}g={...g,[h]:b};let q=0;for(let e in g){let t=g[e],a=s[e],r=a.enabledSale?+a.salePrice:+a.price,n=c[d]["group-pricing"]||{};if(a.enabledGroupDiscount&&Object.keys(n).length>0&&n[e]){var I=n[e];for(let e of I){if(e.to.length<1){r=e.price||r;break}if(+t>=+e.from&&+t<=+e.to){r=e.price;break}}}q+="per-group"===a.pricingType?t&&+r||0:r*+t}e._store.dispatch({type:"UPDATE_STORE",data:{travelerRecord:g,cart:m,cartTotal:{...l,travelers:q}}})};a.on("click",".wte-booking-pc-counter .wte-down",t(this)),a.on("click",".wte-booking-pc-counter .wte-up",t(this)),a.on("click",".wte-time-select-btn",(e=>function(t){var a;let r=this.dataset.time,i=this.dataset.packageId.split(","),{tripPackages:o}=e._store.getState();if(null!=e&&null!==(a=e.tabController)&&void 0!==a&&a.nextBtn){const t=document.querySelector(e.tabController.nextBtn);t&&(t.disabled=!1)}r&&e._store.dispatch({type:"UPDATE_STORE",data:{selectedTime:n(new Date(+r)),availablePackages:i.map((e=>o[e])),selectedPackage:i[0]}})})(this))}getPackageCategories(e){if(!e)return{};let{tripPackages:t}=this._store.getState();return t[e]["package-categories"]}clear(){this._store.dispatch({type:"UPDATE_STORE",data:{selectedDate:n(null),selectedTime:n(null),selectedPackage:null,defaultDateFormat:"YYYY-MM-DD",packageCategories:{},travelerRecord:{},cart:{}}})}updateSelectedTime(){document.getElementById("wte-booking-times-content").innerHTML=wp.template("wte-booking-times")(this._store.getState())}getDefaultCart(e){if(!e)return;let{tripPackages:t,trip:a}=this._store.getState();const r=this.getPackageCategories(e),n={};let i={traveler:0},o=0;const l=null==a?void 0:a.primary_category;if(!r[l])return{cart:i,cartTotal:{travelers:o},travelerRecord:n};let s=r[l],c=l,d=s.enabledSale?+s.salePrice:+s.price,u=parseInt(s.minPax);n[c]=u;let p=t[e]["group-pricing"]||{};if(s.enabledGroupDiscount&&Object.keys(p).length>0&&p[c]){var f=p[c];for(let e of f){if(e.to.length<1){d=e.price||d;break}if(u>=+e.from&&u<=+e.to){d=e.price;break}}}return i.traveler=parseInt(i.traveler)+u,o+="per-group"===s.pricingType?u&&+d||0:d*u,{cart:i,cartTotal:{travelers:o},travelerRecord:n}}bookingProcessFlowControl(e){const t=this;e||this.bookingform.classList.add("wte-bp-flow");const a=document.getElementById("wte-booking-datetime"),r={dateChange:function(){if(a&&t.bookingform.classList.contains("wte-bp-flow")){const e=a.offsetHeight;let t=a.children;if(t[0]){let r=t[0].offsetHeight,n=function(){a.scrollTop<r-e&&(a.scrollTop=r-e>a.scrollTop?a.scrollTop+10:a.scrollTop,setTimeout(n))};n()}}}};r[e]&&r[e]()}initCalendar(){let e=this.getPackagesDates();const t=Object.values(e._nodates);delete e._nodates;let{tripPackages:a,trip:r,cart:i}=this._store.getState();console.debug({_dates:e});let o=e._minDate;delete e._minDate;let l={minDate:o,inline:!0,onChange:(t,i)=>{var o,l;t[0].getTimezoneOffset(),t=new Date(t[0].getTime());let s=moment(t).format("YYYY-MM-DD");this.clear();let c=[];e[s]&&(c=Object.keys(e[s]).map((e=>a[e])));const d=Object.values(a).filter((e=>Object.values(e["package-dates"]).length<1));c=[...c,...d];let u=c.map((e=>e.id)),p=(null==r||null===(o=r.packages_ids)||void 0===o?void 0:o.find((e=>u.indexOf(e)>-1)))||c[0].id,f={};const v=this.getDefaultCart(p),m=e[s]&&e[s][p]||null;if(e[s])for(let[a,n]of Object.entries(e[s])){let e=n;if(!(e._times.length<1))for(let n in e._times){var g,w;let i=e._times[n],o=null==i||null===(g=i.from)||void 0===g?void 0:g.split(":"),l=new Date(t);l.setHours(o[0]),l.setMinutes(o[1]);let s=null==i||null===(w=i.to)||void 0===w?void 0:w.split(":"),c=new Date(t);c.setHours(s[0]),c.setMinutes(s[1]);let d="_"+moment(l).format("HH-mm")+"_"+moment(c).format("HH-mm");if(f[d]){f[d].packages=[...f[d].packages,a];continue}let u=!0;const p=r["booked-seats"],T=.001*l.getTime();if(p&&p[T]){var h,b,y,_,k;u=!(null===(h=p[T])||void 0===h||!h.booked)&&+(null===(b=p[T])||void 0===b?void 0:b.booked)>0;let e=null!=m&&m._seats&&null!==(y=p[T])&&void 0!==y&&y.booked?+m._seats-+p[T].booked:-1;u=!(null!=v&&null!==(_=v.cart)&&void 0!==_&&_.traveler)&&e>0&&e>(null==v||null===(k=v.cart)||void 0===k?void 0:k.traveler)}f[d]={from:l,to:c,packages:[a],formatter:this.timeformatter,isAvailable:u}}}const T=document.querySelector(null===(l=this.tabController)||void 0===l?void 0:l.nextBtn);t&&Object.values(f).length<=0?T&&(T.disabled=!1):T&&(T.disabled=!0),this._store.dispatch({type:"UPDATE_STORE",data:{...v,parentDateConfig:m,selectedDate:n(t),availablePackages:c,selectedPackage:p,availableTimes:f,packageCategories:this.getPackageCategories(p),groupPricings:p?a[p]["group-pricing"]:{}}}),this.bookingProcessFlowControl("dateChange")},disable:[e=>!1],onReady:function(){var e;const t=document.getElementById("open-booking-modal");if(t&&(t.disabled=!1),(null===(e=window.location.search)||void 0===e?void 0:e.split("&").indexOf("action=fsd_booking"))>-1){var a,r;let e=null===(a=window.location.search)||void 0===a?void 0:a.replace("?","").split("&").map((e=>e.split("="))).find((e=>"date"===e[0]));t.click(),null===(r=arguments.length<=2?void 0:arguments[2])||void 0===r||r.setDate(e,!0)}document.dispatchEvent(new Event("bookingCalendarReady"))}};l.disable=[(e=>{let a=o;return r=>!(!o||t.length>0&&moment(r).isSameOrAfter(a)||e[moment(r).format("YYYY-MM-DD")])})({...e})],flatpickr("#wte-booking-date-calendar",l)}formatPrice(e){var t;const{currency:a,baseCurrency:r,currencySymbol:n,format:{number:i,price:o}}=wteL10n;let l={[r]:1};if("undefined"!=typeof wteCc&&null!==(t=wteCc)&&void 0!==t&&t.code)for(let e in wteCc.code)l={...l,[wteCc.code[e]]:wteCc.rate[e]};return e*=+l[a],wteL10n.helpers.priceFormat(e,a,n,o,+i.decimal,i.decimalSeparator,i.thousandSeparator)}updateSummary(){document.getElementById("wte-booking-summary").innerHTML=wp.template("wte-booking-summary")(this._store.getState())}updatePackageTabContent(){document.getElementById("wte-booking-packages-content").innerHTML=wp.template("wte-booking-packages")(this._store.getState())}_dateToUTC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("invalid date"!==(e=new Date(moment(e).tz("utc").toDate())).toString().toLowerCase()){let a=0,r=0;if(t){let e=t.split(":");a=+e[0],r=+e[1]}return new Date(Date.UTC(e.getUTCFullYear(),e.getMonth(),e.getDate(),a,r,0,0))}return e}_dateToTripTimeZone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("invalid date"!==(e=new Date(e)).toString().toLowerCase()){if(e.setHours(0),e.setMinutes(0),e.setSeconds(0),t){let a=t.split(":");e.setHours(+a[0]),e.setMinutes(+a[1])}let a=`${moment(e).format("YYYY-MM-DDTHH:mm:ss")}${wteL10n.format.datetime.timezone}`;return new Date(a)}return e}getPackagesDates(){var t;const{tripPackages:a,trip:r}=this._store.getState();let n={_nodates:[]},i=new Date;i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0),null!==(t=r.cut_off_time)&&void 0!==t&&t.enabled&&(i=moment(i).add(r.cut_off_time.duration,r.cut_off_time.duration_unit).toDate());for(let t in a){let o=a[t]["package-dates"];if(o&&Object.values(o).length<1)n._nodates=[...n._nodates,t];else for(let a in o){let l=o[a],s=e.get(l,"dtstart",null);s=s.split("-");let c=new Date(Date.UTC(s[0],+s[1]-1,s[2],0,0,0,0)),d=c.getTime(),u=c;const p=e.get(l,"times",[]),f=e.get(l,"rrule",{}),v=!!e.get(l,"is_recurring",!1),m=e.get(l,"seats","");if(moment(u).isSameOrAfter(i)){let e=.001*d;if(""!==m&&r["booked-seats"]&&r["booked-seats"][+e]&&parseInt(r["booked-seats"][+e].booked)>=+m);else{let e=s.join("-");(!n._minDate||+n._minDate>moment(e).valueOf())&&(n._minDate=moment(e).valueOf()),n[e]={...n[e]?n[e]:{},[t]:{_times:p,_rrule:f,_isRecurring:v,_seats:m}}}}if(!v)continue;const{r_frequency:g,r_until:w,r_weekdays:h,r_months:b,r_count:y}=null!=f?f:{};let _={freq:g?rrule.RRule[g.toUpperCase()]:rrule.RRule.DAILY,dtstart:c};if(w){let e=this._dateToUTC(w);if(moment(i).isAfter(e))continue;_.until=e}switch(_.count=y?+y:10,g){case"WEEKLY":_.byweekday=h&&Object.values(h).map((e=>rrule.RRule[e]))||[];break;case"MONTHLY":_.bymonth=b&&Object.keys(b).map((e=>+e))||[]}let k=new rrule.RRule(_).all(),T=0;for(let e in k){let a=k[e];if(moment(a.getTime()).isBefore(i))continue;0==e&&(T=_.dtstart.getTime()-a.getTime());let o=a.getTime()+T;if(""!==m&&r["booked-seats"]&&r["booked-seats"][o]&&parseInt(r["booked-seats"][o].booked)>=+m)continue;let l=moment.tz(moment(a).toISOString(),"UTC").format("YYYY-MM-DD"),s=moment(l).valueOf();(!n._minDate||+n._minDate>s)&&(n._minDate=s),n[l]={...n[l]?n[l]:{},[t]:{_times:p,_rrule:f,_isRecurring:v,_seats:m}}}}}return n._minDate||(n._minDate=i),n}async fetchData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.trip=await t.get("trip",{id:wte.trip.id}),this.tripPackagesIds=this.trip.packages_ids||[];try{if("object"!=typeof tripPackagesIds)throw`Trip Error: No Packages Assign to the trip - ${this.trip.id}.`;this.tripPackages=await t.get("packages",{include:this.tripPackagesIds.join(","),per_page:100})}catch(e){this.tripPackages=[],console.debug(`WTE Booking: ${e.message}`)}this.pricingCategories=await t.get("categories"),e&&e()}}window.addEventListener("load",(()=>{let e=document.getElementById("wte__booking");if(e){let t=new i(e);window.WTEBooking=t,jQuery("#open-booking-modal").fancybox({type:"inline",src:"#wte__booking",baseClass:"wte-fb-popup"})}}))})(),jQuery(document).ready((function(e){var t=!1;"1"==rtl.enable&&(t=!0),e(".wpte-trip-feat-img-gallery").owlCarousel({nav:!0,navigationText:["&lsaquo;","&rsaquo;"],items:1,autoplay:!0,slideSpeed:300,paginationSpeed:400,center:!0,loop:!0,rtl:t,dots:!1})})),jQuery((function(e){var t=e(".wpte-bf-step.active"),a=e(".wpte-bf-step-content.active"),r=!1;function n(e,t){if(""==window.wte_fix_date.enabled)return t;try{for(var a=wte_fix_date.cost.length,r=0;r<a;r++){if(wte_fix_date.use_multi_prices)return t;var n=e.split("-").map((function(e){return+e})).join("-"),i=wte_fix_date.cost[r][n];if(void 0!==i)return i}}catch(e){return t}return t}function i(){if(e("body").hasClass("single-trip")){var t=function(){var t=e('.wpte-bf-content-travellers .wpte-bf-number-field > input[type="text"]'),a=0;return e.each(t,(function(e,t){var r=o(t);a+=r})),a}();window.wte.trip.travellersCost=t;var a=calculateGrandTotal(),r=(wteGetFormatedPriceWithCurrencyCodeSymbol(t,wte.currency.code,wte.currency.symbol),wteGetFormatedPrice(a)),i=wteGetFormatedPriceWithCurrencyCodeSymbol(a,wte.currency.code,wte.currency.symbol);wteGetFormatedPriceWithCurrencyCodeSymbol(wte.trip.price,wte.currency.code),window.wteCartFields["trip-cost"]=a,e(".wpte-bf-total-price > .wpte-price").html(r);var l=e('.wpte-bf-content-travellers .wpte-bf-number-field > input[type="text"]'),s="";e.each(l,(function(t,a){var r=e(a).val(),i=e(a).data("cartField"),l=e(a).data("type"),c=e(a).data("costField"),d=o(a),u=wteGetFormatedPriceWithCurrencyCodeSymbol(d,wte.currency.code,wte.currency.symbol),p=e(a).data("pricing-type")||"per-person";window.wteCartFields[i]=r,window.wteCartFields[c]=d,r>1&&("group"==l||"per-group"===p)&&(r=1),-1!==e.inArray(l,Object.keys(wte.pax_labels))&&(l=wte.pax_labels[l]);var f=l.charAt(0).toUpperCase()+l.substring(1);r>1&&"traveler"==l?f="Travelers":r>1&&"child"==l?f="Children":r>1&&"Adult"==l||"adult"==l?f="Adults":r>1&&("group"==l||"per-group"===p)&&(r=1);var v=d/r;if(!isFinite(v)){""==(v=e(a).data("cost"))&&(v=0);try{v=n(window.wteCartFields["trip-date"],v)}catch(e){}}v=(v=parseFloat(v)).toFixed(2);var m=wteGetFormatedPriceWithCurrencySymbol(v,wte.currency.symbol),g=(wteGetFormatedPrice(v),wteGetFormatedPriceWithCurrencyCodeSymbol(v,wte.currency.code,wte.currency.symbol));jQuery(this).parents(".wpte-bf-traveler-block").find(".wpte-bf-price ins").html(g),0!=d&&(s+=`\n                <tr>\n                    <td>${r} x ${f} <span class="wpte-bf-info">(${m}/${l})<span></span></td>\n                    <td>${u}</td>\n                </tr>\n            `)})),e(".wpte-bf-travellers-price-table tbody").html(s),e(".wte-bf-price-detail .wpte-bf-total").html(`\n            ${wte.totaltxt} <b>${i}</b>\n        `)}}function o(t){var a=e(t).val(),r=e(t).data("cost");(isNaN(r)||""==r)&&(r=0);try{r=parseFloat(n(window.wteCartFields["trip-date"],r))}catch(e){}var i=e(t).data("type"),o=e(t).data("pricing-type")||"per-person";if(("group"==i||"per-group"==o)&&a>0)l=parseFloat(r);else var l=parseInt(a)*parseFloat(r);try{l=parseFloat(applyGroupDiscount(a,i,l))}catch(e){}return l}window.wteCartFields={action:"wte_add_trip_to_cart",nonce:e("#nonce").val(),"trip-id":wte.trip.id,travelers:1,"trip-cost":wte.trip.price},toastr.options.positionClass="toast-bottom-full-width",toastr.options.timeOut="10000",e(document).on("click",".wpte-bf-toggle-wrap .wpte-bf-toggle-title",(function(t){t.preventDefault(),e(this).parents(".wpte-bf-toggle-wrap").toggleClass("active"),e(this).siblings(".wpte-bf-toggle-content").fadeToggle("slow",(function(){e(this).is(":visible")?(e(this).siblings(".wpte-bf-toggle-title").find(".wtebf-toggle-title").hide(),e(this).siblings(".wpte-bf-toggle-title").find(".wtebf-toggle-title-active").show()):(e(this).siblings(".wpte-bf-toggle-title").find(".wtebf-toggle-title").show(),e(this).siblings(".wpte-bf-toggle-title").find(".wtebf-toggle-title-active").hide())}))})),jQuery(".wpte-bf-content-travellers .wpte-bf-number-field").each((function(){var t=jQuery(this),a=t.find('input[type="text"]'),r=t.find(".wpte-bf-plus"),n=t.find(".wpte-bf-minus");a.attr("min"),a.attr("max"),r.on("click",(function(a){a.preventDefault();var r=e(this).parent().find("input"),n=e(r).attr("max"),o=parseFloat(r.val());++o>=n&&(o=n),t.find("input").val(o),t.find("input").trigger("change");var l=e(this).parents(".wpte-bf-number-field").find('input[type="text"]').data("cartField");window.wteCartFields[l]=o,i()})),n.on("click",(function(a){a.preventDefault();var r=e(this).parent().find("input"),n=e(r).attr("min"),o=parseFloat(r.val());--o<=n&&(o=n),t.find("input").val(o),t.find("input").trigger("change");var l=e(this).parents(".wpte-bf-number-field").find('input[type="text"]').data("cartField");window.wteCartFields[l]=o,i()}))}));var l=[];try{for(var s=wte_fix_date.cost.length,c=0;c<s;c++)l.push(Object.keys(wte_fix_date.cost[c])[0])}catch(e){}function d(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0))}var u={};function p(e){if(wte.booking_cutoff.enable&&parseInt(wte.booking_cutoff.cutoff)>0){var t=d(new Date),a=60*parseInt(wte.booking_cutoff.cutoff)*60*1e3;if(a="days"===wte.booking_cutoff.unit?24*a:a,bookableDate=new Date(t.getTime()+a),d(e).getTime()<d(bookableDate).getTime())return[]}if(!wte_fix_date.departureDates)return l.map((function(e){return d(new Date(e))}));var r=wte_fix_date.departureDates,n=r.sdate?Object.keys(r.sdate):[],i=new rrule.RRuleSet;return n.forEach((function(t){var a=new rrule.RRuleSet,n=void 0!==r&&void 0!==r[t]?r[t].recurring:null;if(n&&"true"==n.enable){var o={},l=new Date(n.until);if(new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)).getTime()>new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0,0)).getTime())return;o.freq=rrule.RRule[n.type];var s=d(new Date(r.sdate[t]));o.dtstart=s,n.months&&"MONTHLY"==n.type&&(o.bymonth=Object.values(n.months).map((function(e){return+e})),o.dtstart.setDate(s.getDate())),n.week_days&&"WEEKLY"==n.type&&(o.byweekday=Object.values(n.week_days).map((function(e){return rrule.RRule[e]}))),o.count=+n.limit||10,i.rrule(new rrule.RRule(o)),a.rrule(new rrule.RRule(o)),a.all().forEach((function(e){if(!u[e.getTime()]){u[e.getTime()]=!0;var a=e.getFullYear()+"-"+(+e.getMonth()+1)+"-"+e.getDate();wte_fix_date.cost.push({[a]:r.cost[t]});var n=wte_fix_date.bookedSeats[e.getTime()]&&wte_fix_date.bookedSeats[e.getTime()].booked||0,i=+r.seats_available[t]-+n;wte_fix_date.seats_available.push({[a]:i}),wte_fix_date.fdd_ids.push({[a]:e.getTime()})}}))}else{var c=new Date(r.sdate[t]);if(wte.booking_cutoff.enable&&parseInt(wte.booking_cutoff.cutoff)>0){var p=new Date;p=new Date(Date.UTC(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0));var f=60*parseInt(wte.booking_cutoff.cutoff)*60*1e3;f="days"===wte.booking_cutoff.unit?24*f:f,bookableDate=new Date(p.getTime()+f),d(c).getTime()>=d(bookableDate).getTime()&&i.rdate(c)}else d(c).getTime()>=d(new Date).getTime()&&i.rdate(c);if(u[c.getTime()])return;u[c.getTime()]=!0;var v=c.getFullYear()+"-"+(+c.getMonth()+1)+"-"+c.getDate();wte_fix_date.cost.push({[v]:r.cost[t]});var m=wte_fix_date.bookedSeats[c.getTime()]&&wte_fix_date.bookedSeats[c.getTime()].booked||0,g=+r.seats_available[t]-+m;wte_fix_date.seats_available.push({[v]:g}),wte_fix_date.fdd_ids.push({[v]:c.getTime()})}})),i.all()}function f(t){var a=e.datepicker.formatDate(e.datepicker.ISO_8601,t),r=new Date;r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0));var n=null;if(wte.booking_cutoff.enable&&parseInt(wte.booking_cutoff.cutoff)>0){var i=60*parseInt(wte.booking_cutoff.cutoff)*60*1e3;i="days"===wte.booking_cutoff.unit?24*i:i,n=new Date(r.getTime()+i),n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0))}else n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0));if(!wte_fix_date||wte_fix_date.departureDates&&!wte_fix_date.departureDates.cost)return d(t)>=d(n)?[!0,"","Available"]:[!1,"","Unavailable"];var o=p(t).filter((function(e){return d(e)>=n})).map((function(e){return e.getTime()}));if(o.length<=0&&d(t)>=d(n))return[!0,"","Available"];for(var l=wte_fix_date.seats_available.length,s=0;s<l;s++)if(wte_fix_date.seats_available[s][a]){if("0"==wte_fix_date.seats_available[s][a]||""==wte_fix_date.seats_available[s][a])return[!1,"","Unavailable"];break}return $recurredDate=o.find((function(e){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0)).getTime()===e})),$recurredDate?[!0,"","Available"]:[!1,"","Unavailable"]}function v(n){if(!r)return!1;t=n;var i=e(".wpte-bf-step"),o=e(i).index(n);e(a).fadeOut("slow",(function(){e(t).addClass("active"),e(a).removeClass("active"),a=e(".wpte-bf-step-content")[o],e(a).css("display",""),e(a).css("opacity",""),e(a).addClass("active"),0===o?e(".wte-bf-price-detail").css("display","none"):e(".wte-bf-price-detail").css("display",""),o+1>=i.length?e('.wte-bf-price-detail .wpte-bf-btn-wrap input[type="button"]').val(wte.bookNow):e('.wte-bf-price-detail .wpte-bf-btn-wrap input[type="button"]').val(wte_strings.bookingContinue||"Continue")}))}function m(t){var a=e(".wpte-bf-step"),r=e(a).index(t);return!(r+1>=a.length)&&a[r+1]}e(".wpte-bf-datepicker").datepicker({minDate:0,beforeShowDay:"undefined"!=typeof wte_fix_date&&wte_fix_date.departureDates&&"1"==wte_fix_date.enabled?f:0==l.length||"undefined"!=typeof wte_fix_date&&""==window.wte_fix_date.enabled?function(e){if(wte.booking_cutoff.enable&&parseInt(wte.booking_cutoff.cutoff)>0){var t=new Date,a=new Date(e.getTime()+864e5),r=60*parseInt(wte.booking_cutoff.cutoff)*60*1e3;if(r="days"===wte.booking_cutoff.unit?24*r:r,new Date(t.getTime()+r).getTime()>a.getTime())return[!1,"","Unavailable"]}return[!0,"","Available"]}:f,dateFormat:"yy-mm-dd",onSelect:function(a,n){r=!0;var o=m();if(o&&(e(".wpte-bf-step").removeClass("active"),e(t).removeClass("active"),v(o)),window.wteCartFields["trip-date"]!=a){window.wteCartFields["trip-date"]=a;try{if(""==window.wte_fix_date.enabled)return}catch(e){}try{for(var l=wte_fix_date.seats_available.length,s=0;s<l;s++){var c=wte_fix_date.seats_available[s][a];if(wte_fix_date.cost[s][a],void 0!==c){var d=e(".wpte-bf-content-travellers").find('input[type="text"]');e.each(d,(function(t,a){var r=e(a).data("cartField"),n="travelers"==r||"pricing_options[adult][pax]"==r?1:0;e(a).val(n),e(a).attr("max",c),e(".wpte-bf-content-travellers").data("maxtravellers",c)}))}}}catch(e){}i()}}}),e('.wpte-bf-btn-wrap > input[type="button"]').on("click",(function(a){a.preventDefault();var r=m(t);if(r){if("wpte-bf-step-travellers"==t.dataset.stepName||"travellers"==t.innerText.toLowerCase()){var n=0;e(".wpte-bf-content-travellers").find("input").each((function(t,a){n+=parseInt(e(a).val(),10)}));var i=parseInt(e(".wpte-bf-content-travellers").data("mintravellers")),o=parseInt(e(".wpte-bf-content-travellers").data("maxtravellers"));if(!(n>=i&&n<=o)){var l=wte_strings.pax_validation.replace("%2$s",i).replace("%3$s",o).replace("%1$s",n);return toastr.error(l),!1}e(".wpte-bf-step").removeClass("active"),e(t).removeClass("active"),v(r)}}else e.ajax({type:"POST",url:WTEAjaxData.ajaxurl,data:window.wteCartFields,success:function(t){var a;if(t.success)e("#price-loading").fadeOut(500),location.href=wp_travel_engine.CheckoutURL;else for(a=0;a<t.data.length;a++)toastr.error(t.data[a])}})})),e("#wpte-booking-form").on("click",".wpte-bf-step",(function(t){if(t.preventDefault(),!r)return!1;e(".wpte-bf-step").removeClass("active"),e(this).removeClass("active"),v(this)})),document.getElementById("wpte-booking-form")&&i()})),jQuery(document).ready((function(e){e(".disabled_______book-submit").click((function(t){t.preventDefault();var a="#"+e(this).data("formid"),r={};e(a+" input, "+a+" select").each((function(t){if(filterby=e(this).attr("name"),filterby_val=e(this).val(),1==e(this).data("multiple")){if(void 0===r[filterby]&&(r[filterby]=[]),"checkbox"==e(this).attr("type")&&e(this).is(":checked")&&r[filterby].push(filterby_val),1==e(this).data("dependent")){var a=e(this).data("parent");e("#"+a).is(":checked")&&r[filterby].push(filterby_val)}}else r[filterby]=filterby_val})),r.action="wte_add_trip_to_cart",r.tid=r["trip-id"],e.ajax({type:"POST",url:wp_travel_engine.ajaxurl,data:r,beforeSend:function(){e("#price-loading").fadeIn(500)},success:function(t){e("#price-loading").fadeOut(500),location.href=wp_travel_engine.CheckoutURL}})}))})),jQuery(document).ready((function(e){e(".trip-price").stick_in_parent()})),jQuery(document).ready((function(e){e(".wp-travel-engine-datetime").datepicker({maxDate:0,changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"-100:+0"})})),function(e,t,a,r){function n(){a(t).find(".trip-review-stars").length&&a(t).find(".trip-review-stars").each((function(){var e=a(this).data("rating-value"),t=""!==(t=a(this).data("icon-type"))?t:"";a(this).rateYo({rating:e,starSvg:t})}))}jQuery(t).ready((function(e){e("body").on("click",".btn-loadmore",(function(t){t.preventDefault();var a=e(this),r=a.attr("data-current-page"),i=a.attr("data-max-page"),o={action:"wpte_ajax_load_more",query:a.attr("data-query-vars"),page:r,nonce:beloadmore.nonce};e.ajax({url:beloadmore.url,data:o,type:"POST",beforeSend:function(t){e("#loader").fadeIn(500)},success:function(e){a.before(e),r++,a.attr("data-current-page",r),r==i&&a.remove()},complete:function(){e("#loader").fadeOut(500),n()}})})),e("body").on("click",".load-destination",(function(t){t.preventDefault();var a=e(this),r=a.attr("data-current-page"),i=a.attr("data-max-page"),o={action:"wpte_ajax_load_more_destination",query:a.attr("data-query-vars"),page:r,nonce:beloadmore.nonce};e.ajax({url:beloadmore.url,data:o,type:"POST",beforeSend:function(t){e("#loader").fadeIn(500)},success:function(e){a.before(e),r++,a.attr("data-current-page",r),r==i&&a.remove()},complete:function(){e("#loader").fadeOut(500),n()}})}))}))}(window,document,jQuery),(()=>{function e(e){for(var t=(e+="").split("."),a=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;n.test(a);)a=a.replace(n,"$1"+WPTE_Price_Separator+"$2");return a+r}jQuery((function(t){wte.single_showtabs||(t(".tab-inner-wrapper .tab-anchor-wrapper:first-child").addClass("nav-tab-active"),t(".nb-tab-trigger").click((function(){t(".nb-tab-trigger").removeClass("nav-tab-active"),t(".nb-tab-trigger").parent().parent().removeClass("nav-tab-active"),t(this).addClass("nav-tab-active"),t(this).parent().parent().addClass("nav-tab-active");var e=t(this).data("configuration");t(".nb-configurations").hide(),t(".nb-"+e+"-configurations").show()})),t(".tab_content").hide(),t(".tab_content:first").show(),t("ul.tabs li").click((function(){t(".tab_content").hide();var e=t(this).attr("rel");t("#"+e).fadeIn(),t("ul.tabs li").removeClass("active"),t(this).addClass("active"),t(".tab_drawer_heading").removeClass("d_active"),t(".tab_drawer_heading[rel^='"+e+"']").addClass("d_active")})),t(".tab_drawer_heading").click((function(){t(".tab_content").hide();var e=t(this).attr("rel");t("#"+e).fadeIn(),t(".tab_drawer_heading").removeClass("d_active"),t(this).addClass("d_active"),t("ul.tabs li").removeClass("active"),t("ul.tabs li[rel^='"+e+"']").addClass("active")})),t("ul.tabs li").last().addClass("tab_last")),t((function(){var e=t(".payment-check");!1===e.is(":checked")&&e.is(":visible")&&(e.filter("[value=paypal]").prop("checked",!0),t(".stripe-button").removeClass("active"),t(".stripe-button-el").hide(),t("#wp-travel-engine-order-form").attr("action",WP_OBJ.link.paypal_link))})),t("body").on("click",".paypal-form",(function(e){var a=t(".stripe_checkout_app").attr("src");t(".stripe_checkout_app").attr("src",""),t(".stripe_checkout_app").attr("src",a),t("#wp-travel-engine-order-form").submit()})),t("body").on("click",".payment-check",(function(e){t(this).is(":checked")&&("stripe"==t(this).attr("value")&&(t("#wp-travel-engine-order-form").attr("action",WP_OBJ.link.form_link),t(".paypal-form").hide(),t(".stripe-form").fadeIn("slow"),t(".stripe-button").addClass("active"),t(".stripe-button-el").show()),"paypal"==t(this).attr("value")&&(t("#wp-travel-engine-order-form").attr("action",WP_OBJ.link.paypal_link),t(".stripe-button").removeClass("active"),t(".stripe-button-el").hide(),t(".paypal-form").fadeIn("slow")))})),t("body").on("click",".check-availability",(function(e){e.preventDefault(),t(".date-time-wrapper").fadeIn("slow")})),t("body").on("click",".check-availability",(function(e){e.preventDefault(),t(".wp-travel-engine-price-datetime").focus()})),t("body").on("click",".wp-travel-engine-cart",(function(e){e.preventDefault(),trip_id=t(this).attr("data-id"),nonce=t(this).attr("data-nonce"),jQuery.ajax({type:"post",dataType:"json",url:WTEAjaxData.ajaxurl,data:{action:"wp_add_trip_cart",trip_id,nonce},success:function(e){"already"===e.type?(t(".wp-cart-message-"+trip_id).css("color","orange"),t(".wp-cart-message-"+trip_id).html(e.message).fadeIn("slow").delay(3e3).fadeOut("slow")):"success"===e.type?(t(".wp-cart-message-"+trip_id).css("color","green"),t(".wp-cart-message-"+trip_id).html(e.message).fadeIn("slow").delay(3e3).fadeOut("slow")):(t(".wp-cart-message-"+trip_id).css("color","red"),t(".wp-cart-message-"+trip_id).html(e.message).fadeIn("slow").delay(3e3).fadeOut("slow")),t(".wte-update-cart-button-wrapper:visible").length<1&&t(".wte-update-cart-button-wrapper").css("display","block")}})})),t("#price-loading").fadeOut(2e3),t(".price-holder").fadeIn(2e3),t("body").on("change",".travelers-number",(function(a){$val=t(this).val(),$new_val=t(this).parent().parent().siblings(".trip-price-holder").children(".cart-price-holder").text().replace(/,/g,""),$total=$val*$new_val,$total=e($total),t(this).parent().parent().siblings(".cart-trip-total-price").children(".cart-trip-total-price-holder").text($total),$sum=0,t(".cart-trip-total-price-holder").each((function(e){$tcost=t(this).text().replace(/,/g,""),$sum=parseInt($sum)+parseInt($tcost)})),$sum=e($sum),t(".total-trip-price").text($sum),$value=0,$val1=parseInt(t("span.travelers-number").text()),t("input.travelers-number").each((function(e){""!==t(this).val()&&($value=parseInt($value)+parseInt(t(this).val()))})),$travelers=parseInt($value)+parseInt($val1),t(".total-trip-travelers").text($travelers)})),t("#wp-travel-engine-cart-form").on("submit",(function(e){e.preventDefault();var a=t("#wp-travel-engine-cart-form").serialize(),r=t("#update_cart_action_nonce").val();jQuery.ajax({type:"post",url:WTEAjaxData.ajaxurl,data:{action:"wte_update_cart",nonce:r,data2:a},success:function(){t(".wte-update-cart-msg").text(WPMSG_OBJ.ajax.success),t(".wte-update-cart-msg").css("color","green").fadeIn("slow").delay(3e3).fadeOut("slow")}})})),t("#wte_payment_options").on("change",(function(e){var a=t("#wte_payment_options :selected").val();e.preventDefault(),""!=a&&t("#price-loader").fadeIn("slow").delay("3000").fadeOut("3000")})),t(".accordion-tabs-toggle").next().hasClass("show"),t(".accordion-tabs-toggle").next().removeClass("show"),t(".accordion-tabs-toggle").next().slideUp(350),t(document).on("click",".faq-row .accordion-tabs-toggle",(function(){var e=t(this);e.siblings(".faq-content").toggleClass("show"),e.toggleClass("active"),e.siblings(".faq-content").slideToggle(350),e.find(".dashicons.dashicons-arrow-down.custom-toggle-tabs").toggleClass("open")})),t(document).on("click",".expand-all-faq",(function(e){e.preventDefault(),t(this).children("svg").hasClass("fa-toggle-off")&&t(this).children("svg").toggleClass("fa-toggle-on"),t(this).children("svg").hasClass("fa-toggle-on")&&t(this).children("svg").toggleClass("fa-toggle-off"),t(".faq-row .accordion-tabs-toggle").toggleClass("active"),t(".faq-row").children(".faq-content").toggleClass("show"),t(".faq-row").children(".faq-content").slideToggle(350),t(".faq-row").find(".dashicons.dashicons-arrow-down.custom-toggle-tabs").toggleClass("open")})),t('form[name="wte_enquiry_contact_form"]').submit((function(e){if(e.preventDefault(),t("#wte_enquiry_contact_form").parsley().isValid()){t("#enquiry_submit_button").prop("disabled",!0);var a=jQuery("#redirect-url").val(),r=new FormData(this);t.ajax({dataType:"json",type:"post",processData:!1,contentType:!1,url:WTEAjaxData.ajaxurl,data:r,success:function(e){"success"===e.type?jQuery(".success-msg").html(e.message).fadeIn("slow").delay("3000").fadeOut("3000",(function(){window.location.href=a})):"error"===e.type?(jQuery("#enquiry_email").css("border","1px solid red"),jQuery(".failed-msg").html(e.message).fadeIn("slow").delay("3000").fadeOut("slow",(function(){jQuery("#enquiry_email").css("border","1px solid #d1d1d1"),jQuery("#enquiry_submit_button").prop("disabled",!1)}))):jQuery(".failed-msg").html(e.message).fadeIn("slow").delay("3000").fadeOut("slow",(function(){t("#enquiry_submit_button").prop("disabled",!1)}))}})}})),t("#wp-travel-engine-order-form").submit((function(e){if("Himalayan-Bank"!=t("#wte_payment_options :selected").val()){var a=t(this),r=a.find("input[name=amount]").val();!isNaN(r)&&r.length>0&&(options_val=r,t("<input>").attr({type:"hidden",id:"amount",name:"amount",value:options_val}).appendTo(a))}})),t("#wte_payment_options").on("change",(function(e){var a=t("#wte_payment_options :selected").val();if(e.preventDefault(),""==a||"Test Payment"==a)return t("#wte-checkout-payment-fields").html(""),t("#wp-travel-engine-order-form").attr("action",Url.normalurl),t(".wp-travel-engine-billing-details-wrapper").html(response.data),t(".stripe-button:visible").remove(),t(".stripe-button-el").remove(),t(".wp-travel-engine-submit").show(),void t(".wte-authorize-net-wrap").remove();"PayPal"==a&&jQuery.ajax({type:"post",url:WTEAjaxData.ajaxurl,data:{action:"wte_payment_gateway",val:a,_nonce:WTEAjaxData.nonce},success:function(e){"PayPal"==a&&(t("#wp-travel-engine-order-form").attr("action",Url.paypalurl),t(".wp-travel-engine-billing-details-wrapper").html(e.data),t("#wte-checkout-payment-fields").html(e.data),t(".stripe-button:visible").remove(),t(".stripe-button-el").remove(),t(".wp-travel-engine-submit").show(),t(".wte-authorize-net-wrap").remove()),"Test Payment"==a&&(t("#wp-travel-engine-order-form").attr("action",Url.normalurl),t(".wp-travel-engine-billing-details-wrapper").html(e.data),t(".stripe-button:visible").remove(),t(".stripe-button-el").remove(),t(".wp-travel-engine-submit").show(),t(".wte-authorize-net-wrap").remove())}})})),t("body").on("keyup","#cost_includes",(function(e){t("#include-result").val(t("#cost_includes").val()),t("#include-result").val("<li>"+t("#include-result").val().replace(/\n/g,"</li><li>")+"</li>")})),t("body").on("keyup","#cost_excludes",(function(e){t("#exclude-result").val(t("#cost_excludes").val()),t("#exclude-result").val("<li>"+t("#exclude-result").val().replace(/\n/g,"</li><li>")+"</li>")})),t("body").on("keyup",".itinerary-content",(function(e){t(this).siblings(".itinerary-content-inner").val(t(this).val()),t(this).siblings(".itinerary-content-inner").val("<p>"+t(this).val().replace(/\n/g,"</p><p>")+"</p>")})),t(document).on("click",".expand-all-itinerary",(function(e){e.preventDefault(),t(this).children("i").toggleClass("fa-toggle-on"),t(".itinerary-row").children(".itinerary-content").toggleClass("show"),t(".itinerary-row").children(".itinerary-content").slideToggle(350),t(".itinerary-row").find(".dashicons.dashicons-arrow-down.custom-toggle-tabs").toggleClass("rotator")})),t(document).on("click",".less-no",(function(e){$val=t(this).next("input").val(),0!=$val&&($val=parseInt($val)-1,t(this).next("input").val($val))})),t(document).on("click",".more-no",(function(e){if($val=t(this).prev("input").val(),""==$val)return $val=1,void t(this).prev("input").val($val);$val=parseInt($val)+1,t(this).prev("input").val($val)})),t("#wp-travel-engine-new-checkout-form").parsley(),t("input[name=wp_travel_engine_payment_mode]").length>0&&t(document).on("change","input[name=wp_travel_engine_payment_mode]",(function(){var e=t("input[name=wp_travel_engine_payment_mode]:checked").val(),a=t(".wpte-bf-book-summary .wpte-bf-extra-info-table"),r="partial"==e?wte.payments.total_partial:wte.payments.total;r=wteGetFormatedPriceWithCurrencyCodeSymbol(r),"partial"==e?a.show():a.hide(),t(".wpte-bf-book-summary .wpte-bf-total-price .wpte-price").html(r)})),t("#wte-send-enquiry-message").click((function(e){e.preventDefault(),document.getElementById("wte_enquiry_contact_form").scrollIntoView({behavior:"smooth",block:"center"})})),t("#wte_enquiry_contact_form").parsley(),t(".wte-ordering").on("change","select.orderby",(function(){t(this).closest("form").submit()})),t(window).on("load",(function(){t(window).width()<1025?t(".single-trip .wte_enquiry_contact_form-wrap").insertAfter(".single-trip .widget-area .wpte-bf-outer"):t(".single-trip .widget-area .wte_enquiry_contact_form-wrap").insertAfter(".single-trip .site-main")}));var a=document.querySelectorAll(".wpte-enhanced-select");function r(e,t){null!=e&&null!=t&&e.contentWindow.postMessage(JSON.stringify(t),"*")}function n(e,t){var a,n,i,o,l;if(n=(a=e.find(".slick-current")).attr("class").split(" ")[1],o=a.find("iframe").get(0),i=a.data("video-start"),"vimeo"===n)switch(t){case"play":null!=i&&i>0&&!a.hasClass("started")&&(a.addClass("started"),r(o,{method:"setCurrentTime",value:i})),r(o,{method:"play",value:1});break;case"pause":r(o,{method:"pause",value:1})}else if("youtube"===n)switch(t){case"play":r(o,{event:"command"}),r(o,{event:"command",func:"playVideo"});break;case"pause":r(o,{event:"command",func:"pauseVideo"})}else"video"===n&&null!=(l=a.children("video").get(0))&&("play"===t?l.play():l.pause())}a&&a.forEach((function(e){t(e).select2({closeOnSelect:!1,allowClear:!1})})),t(".wte-trip-vidgal-popup-trigger").on("click",(function(e){e.preventDefault();var a=t(this).data("variable");t.fancybox.open(window[a],{buttons:["zoom","slideShow","fullScreen","close"]})}));var i=t(".main-slider");i.slick&&(i.on("beforeChange",(function(e,a){n(a=t(a.$slider),"pause")})),i.on("afterChange",(function(e,a){n(a=t(a.$slider),"play")})),i.slick({lazyLoad:"progressive",slidesToShow:1,slidesToScroll:1,arrows:!1,dots:!1,fade:!0,asNavFor:".slider-nav",cssEase:"cubic-bezier(0.87, 0.03, 0.41, 0.9)"}),t(".slider-nav").slick({slidesToShow:3,slidesToScroll:1,asNavFor:".main-slider",dots:!1,arrows:!0,focusOnSelect:!0}))})),function(){var e=document.querySelectorAll(".wpte-bf-toggle-wrap");function t(e,t){return function a(r){var n=e.querySelector(".wpte-bf-toggle-content");e.className.indexOf("wpte-bf-active")>-1?function(e,t){var a=1;!function r(){if((a-=.05)<=0)return e.style.removeProperty("opacity"),e.style.display="none",void t();e.style.opacity=a,requestAnimationFrame(r)}()}(n,(function(){document.removeEventListener("click",a),e.classList.remove("wpte-bf-active"),t()})):(e.className.indexOf("wpte-bf-active")<0?e.classList.add("wpte-bf-active"):e.classList.remove("wpte-bf-active"),t())}}e&&e.forEach((function(e){var a=e.querySelector(".wpte-bf-toggle-title"),r=(e.querySelector(".wpte-bf-toggle-content"),e.querySelector(".wpte-bf-toggle-close"));r&&r.addEventListener("click",(function(a){a.preventDefault(),t(e)})),a&&a.addEventListener("click",(function(r){document.addEventListener("click",t(e,(function(){var t=a.querySelector(".wtebf-toggle-title"),r=a.querySelector(".wtebf-toggle-title-active");r&&(r.style.display=e.className.indexOf("wpte-bf-active")>-1?"block":"none"),t&&(t.style.display=e.className.indexOf("wpte-bf-active")<0?"block":"none")})))}))}))}()})(),jQuery(document).ready((function(e){e("form.wpte-lrf").parsley(),e("a#wpte-show-login-form").click((function(t){t.preventDefault(),e(".wpte-lrf-wrap.wpte-register").slideUp("slow"),e(".wpte-lrf-wrap.wpte-login").slideDown("slow")})),e("a#wpte-show-register-form").click((function(t){t.preventDefault(),e(".wpte-lrf-wrap.wpte-register").slideDown("slow"),e(".wpte-lrf-wrap.wpte-login").slideUp("slow")}))})),jQuery(document).ready((function(e){e(".wpte-dashboard .wpte-lrf-userprogile > a").on("click",(function(t){t.stopPropagation(),e(this).parent(".wpte-lrf-userprogile").toggleClass("active"),e(this).siblings(".lrf-userprofile-popup").stop(!0,!1,!0).slideToggle()})),e(".wpte-dashboard .wpte-lrf-userprogile .lrf-userprofile-popup").on("click",(function(e){e.stopPropagation()})),e("body, html").on("click",(function(){e(".wpte-lrf-userprogile").removeClass("active"),e(".lrf-userprofile-popup").slideUp()})),e(".wpte-dashboard .wpte-lrf-sidebar .wpte-lrf-tab").on("click",(function(){var t=e(this).attr("class").split(" ")[1];e(".wpte-lrf-tab").removeClass("active"),e(this).addClass("active"),e(".wpte-dashboard .wpte-lrf-content-area .wpte-lrf-tab-content").removeClass("active"),e("."+t+"-content").addClass("active")})),e(".lrf-toggle .lrf-toggle-box").on("click",(function(){e(this).toggleClass("active"),e(this).parents(".lrf-toggle").siblings(".wpte-lrf-popup").stop(!0,!1,!0).slideToggle()})),e(window).keyup((function(t){"Escape"==t.key&&(e(".wpte-lrf-userprogile").removeClass("active"),e(".lrf-userprofile-popup").slideUp(),e(this).removeClass("active"),e(".wpte-lrf-popup").slideUp())})),e(".wte-dbrd-tab").click((function(t){t.preventDefault();var a=e(this).data("tab");e(".wpte-lrf-sidebar .wpte-lrf-tab").removeClass("active"),e(".wpte-lrf-sidebar .lrf-"+a).addClass("active"),e(".wpte-lrf-main .wpte-lrf-tab-content").removeClass("active"),e(".wpte-lrf-main .lrf-"+a).addClass("active")})),jQuery(".wpte-magnific-popup").fancybox({type:"inline",baseClass:"wte-fb-popup"})})),jQuery(document).ready((function(e){function t(e){for(var t=(e+="").split("."),a=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;n.test(a);)a=a.replace(n,"$1"+WPTE_Price_Separator+"$2");return a+r}e("body").on("change",".travelers-no",(function(a){e("#price-loading").fadeIn(500),$val=e(this).val(),$new_val=e(".hidden-price").first().text().replace(/,/g,""),$total=$val*$new_val,e("#trip-cost").val($total),$total=t($total),e(".total").text(t($total)),e("#price-loading").fadeOut(500)}))})),e=document.querySelectorAll(".wpte-checkout-payment-info"),(t=document.querySelectorAll("[name=wpte_checkout_paymnet_method]"))&&t.forEach((function(t){t.checked&&t.parentElement.classList.add("wpte-active-payment-method")&&t.parentElement.querySelector(".wpte-checkout-payment-info").removeAttribute("style"),t.addEventListener("change",(function(t){e&&e.forEach((function(e){e.style.display="none",e.parentElement.classList.remove("wpte-active-payment-method")})),t.target.parentElement.classList.add("wpte-active-payment-method");var a=t.target.parentElement.querySelector(".wpte-checkout-payment-info");a&&a.removeAttribute("style")}))})),new function(e){var t=this;if(e){if(this.applyBtn=e.querySelector(".wp-travel-engine-coupons-apply-btn"),this.resetBtn=e.querySelector(".wte-coupon-response-reset-coupon"),this.tripsField=e.querySelector('input[name="wte_couponse_trip_id"]'),this.dismissButton=e.querySelector(".wte-coupon-remove-trigger"),!this.tripsField)throw new Error("No trips Field.");this.couponCodeField=e.querySelector('input[name="wp_travel_engine_coupon_code_input"]'),this.nonceField=document.getElementById("wte_apply_coupon_nonce"),this.resetNonceField=document.getElementById("wte_reset_coupon_nonce"),this.loader=e.querySelector("#price-loader-coupon"),this.loading=!1,this.summaryTable=document.querySelector(".wpte-bf-summary-table"),this.responseHolder=document.getElementById("coupon-response-holder"),this.dismissButton&&this.dismissButton.addEventListener("click",(function(t){t.preventDefault(),e.remove()})),this.applyBtn&&this.applyBtn.addEventListener("click",function(e){return function(r){r.preventDefault(),a(!0),function(){var e;if(null!==(e=WTEAjaxData)&&void 0!==e&&e.ajaxurl){var a=new FormData;return a.append("action","wte_session_cart_apply_coupon"),a.append("trip_ids",t.tripsField.value),a.append("CouponCode",t.couponCodeField.value),a.append("trip_id",WTEAjaxData.trip_id),a.append("_nonce",t.nonceField.value),setTimeout((function(){return new Promise((function(e,t){return e(!1)}))}),5e3),fetch(WTEAjaxData.ajaxurl,{method:"POST",body:a})}}().then((function(e){return e.json()})).then((function(t){if(t.success)location.reload();else{var r,n=wp.template("wte-coupon-response");wp.template("wte-coupon-response-updated-price"),e.responseHolder&&(r=t.data.reduce((function(e,t){return"".concat(e).concat(t.message)}),""),e.responseHolder.innerHTML=n({type:"error",message:r})),a(!1)}}))}}(this)),this.resetBtn&&this.resetBtn.addEventListener("click",(function(e){e.preventDefault(),a(!0),function(){var e;if(null!==(e=WTEAjaxData)&&void 0!==e&&e.ajaxurl){var a=new FormData;return a.append("action","wte_session_cart_reset_coupon"),a.append("_nonce",t.resetNonceField.value),setTimeout((function(){return new Promise((function(e,t){return e(!1)}))}),5e3),fetch(WTEAjaxData.ajaxurl,{method:"POST",body:a})}}().then((function(e){return e.json()})).then((function(e){if(e.success)window.location.reload();else{var t,r=wp.template("wte-coupon-response");wp.template("wte-coupon-response-updated-price"),couponInstance.responseHolder&&(t=e.data.reduce((function(e,t){return"".concat(e).concat(t.message)}),""),couponInstance.responseHolder.innerHTML=r({type:"error",message:t})),a(!1)}}))}))}function a(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&!this.loading&&this.loader&&(this.loader.style.removeProperty("display"),summaryTable&&(summaryTable.style.opacity=".3"),this.loading=!0),!e&&this.loading&&this.loader&&(this.loader.style.display="none",summaryTable&&(summaryTable.style.opacity="1"),this.loading=!1)}}(document.getElementById("wte-checkout-coupon")||null),function(e,t){if(e&&null!=e&&e.l10ns&&t){const a=t.split("_");null==e||e.localize(e.l10ns[a[0]]||e.l10ns.en)}}(window.flatpickr,window.wteL10n.locale),function(e){var t,a,r;if(!e)return;const n=e&&e.querySelector("[type=submit]"),i=(null==n?void 0:n.value)||"Book Now",o=(null==n||null===(t=n.dataset)||void 0===t?void 0:t.checkoutLabel)||"Pay %s";let l=(null===(a=e.querySelector("[name=wp_travel_engine_payment_mode]:checked"))||void 0===a?void 0:a.value)||"full_payment",s=(null===(r=e.querySelector("[name=wpte_checkout_paymnet_method]:checked"))||void 0===r?void 0:r.value)||"booking_only";e.addEventListener("change",(function(t){var a,r,c,d,u,p,f,v;const m=(null===(a=e.querySelector("[name=wp_travel_engine_payment_mode]:checked"))||void 0===a?void 0:a.value)||"full_payment",g=(null===(r=e.querySelector("[name=wpte_checkout_paymnet_method]:checked"))||void 0===r?void 0:r.value)||"booking_only",w={partial:(null===(c=window)||void 0===c||null===(d=c.wptravelengineCart)||void 0===d||null===(u=d.cart_totals)||void 0===u?void 0:u.cart_total_partial)||0,full_payment:(null===(p=window)||void 0===p||null===(f=p.wptravelengineCart)||void 0===f||null===(v=f.cart_totals)||void 0===v?void 0:v.total)||0,remaining_payment:wte.payments.total-wte.payments.total_partial};if(l!=m||s!=g){if(l=m,s=g,["booking_only","direct_bank_transfer","check_payments"].includes(g))return void(n.value=i);let e=parseFloat(w[m])||0;n&&(n.value=o.replace("%s",wteL10n.priceFormat(e).format(!0)))}}))}(document.getElementById("wp-travel-engine-new-checkout-form")),function(e){var t=document.querySelectorAll(".wte-search-terms-list");function a(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(a){e.classList.toggle("visible",t)}}if(t)for(var r=0;r<t.length;r++){var n=t[r].querySelector(".wte-terms-more");if(n){var i=n.querySelector(".show-more"),o=n.querySelector(".show-less");i&&i.addEventListener("click",a(n,!0)),o&&o.addEventListener("click",a(n,!1))}}const l=e=>function(t,a){const r=e.querySelector("[data-value]"),n=e.querySelector("[data-value-min]"),i=e.querySelector("[data-value-max]"),o=e.querySelector("[data-value-min-display]"),l=e.querySelector("[data-value-max-display]"),s="price"===e.dataset.valueFormat;r&&(r.value=s?wteL10n.priceFormat(a.values[0]).format(!0)+" - "+wteL10n.priceFormat(a.values[1]).format(!0):a.values[0]+" "+(e.dataset.suffix||"")+" - "+a.values[1]+" "+(e.dataset.suffix||"")),n&&(n.value=a.values[0]),i&&(i.value=a.values[1]);const c=e.querySelectorAll(".ui-slider-handle");o&&(o.innerHTML=s?wteL10n.priceFormat(a.values[0]).format(!0):a.values[0]+" "+(e.dataset.suffix||"")),c&&c[0]&&(c[0].dataset.value=s?wteL10n.priceFormat(a.values[0]).format(!0):a.values[0]+" "+(e.dataset.suffix||"")),l&&(l.innerHTML=s?wteL10n.priceFormat(a.values[1]).format(!0):a.values[1]+" "+(e.dataset.suffix||"")),c&&c[1]&&(c[1].dataset.value=s?wteL10n.priceFormat(a.values[1]).format(!0):a.values[1]+" "+(e.dataset.suffix||""))},s=t=>{var a;const r=t.querySelector(t.dataset.rangeSlider);if(!r)return;const n=null===(a=t.dataset.range)||void 0===a?void 0:a.split(",").map((e=>+e)),i="price"===t.dataset.valueFormat;window.noUiSlider?(noUiSlider.create(r,{start:n||[0,50],range:{min:[n&&n[0]||0],max:[n&&n[1]||50]},tooltips:[wNumb({decimals:i?2:0,suffix:t.dataset.suffix?" "+t.dataset.suffix:""}),wNumb({decimals:i?2:0,suffix:t.dataset.suffix?" "+(i?wteL10n.baseCurrencySymbol:t.dataset.suffix||""):""})],format:wNumb({decimals:i?2:0}),step:1,connect:!0}),r.noUiSlider.on("update",(e=>function(t,a){console.debug({values:t});const r=e.querySelector("[data-value]"),n=e.querySelector("[data-value-min]"),i=e.querySelector("[data-value-max]"),o=e.querySelector("[data-value-min-display]"),l=e.querySelector("[data-value-max-display]"),s="price"===e.dataset.valueFormat;r&&(r.value=s?wteL10n.priceFormat(t[0]).format(!0)+" - "+wteL10n.priceFormat(t[1]).format(!0):t[0]+" "+(e.dataset.suffix||"")+" - "+t[1]+" "+(e.dataset.suffix||"")),n&&(n.value=t[0]),i&&(i.value=t[1]);const c=e.querySelectorAll(".ui-slider-handle");o&&(o.innerHTML=s?wteL10n.priceFormat(t[0]).format(!0):t[0]+" "+(e.dataset.suffix||"")),c&&c[0]&&(c[0].dataset.value=s?wteL10n.priceFormat(t[0]).format(!0):t[0]+" "+(e.dataset.suffix||"")),l&&(l.innerHTML=s?wteL10n.priceFormat(t[1]).format(!0):t[1]+" "+(e.dataset.suffix||"")),c&&c[1]&&(c[1].dataset.value=s?wteL10n.priceFormat(t[1]).format(!0):t[1]+" "+(e.dataset.suffix||""))})(t))):e(r).slider({range:!0,min:n&&n[0]||0,max:n&&n[1]||50,values:n||[0,50],slide:l(t)})};window.addEventListener("load",(function(e){const t=document.querySelectorAll("[data-range-slider]");if(t)for(let e=0;e<t.length;e++)t[e]&&s(t[e]);!function(e){var t=document.querySelectorAll(e);if(t)for(var a=t.length,r=0;r<a;r++){const e=t[r];if(!e)continue;const l=e.querySelector(".wpte__input"),s=e.querySelector(".wpte__input-value");l&&(null==l||l.setAttribute("readonly",""),null==l||l.addEventListener("click",(function(r){r.stopPropagation();const n=e.classList.contains("options-open");for(var i=0;i<a;i++)t[i].classList.remove("options-open");e.classList.toggle("options-open",!n)})));var n=e.querySelector(".wpte__select-options");if(!n)continue;var i=n.querySelectorAll("li"),o=i.length;const c=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&Array.from(e).forEach((e=>{a?e.classList.add(t):e.classList.remove(t)}))},d=t=>{const a=t;a.dataset.label&&(l.setAttribute("value",a.dataset.label),s.setAttribute("value",a.dataset.value),c(e.querySelectorAll("li"),"selected",!1),a.classList.add("selected"),a.closest("li").classList.add("selected"),e.classList.remove("options-open"),e.dispatchEvent(new CustomEvent("change",{detail:{value:a.dataset.value,name:s.name}})))};for(let e=0;e<o;e++)""==i[e].dataset.selected&&d(i[e]),i[e].addEventListener("click",(function(e){e.stopPropagation(),d(this)}))}document.addEventListener("click",(function(t){if("wpte__input"!=t.target.className)for(var a=document.querySelectorAll(e),r=a.length,n=0;n<r;n++)a[n].classList.remove("options-open")}))}(".wpte__select-field");const a=document.querySelector(".wte-ordering"),r=a&&a.querySelector(".wpte__select-field")||null;r&&r.addEventListener("change",(function(e){null==a||a.submit()})),new class{constructor(e){var t,a,r;this.component=document.querySelector(e),this.component&&(this.resetButton=this.component.querySelector("#reset-trip-search-criteria"),this.resetButton&&this.resetButton.addEventListener("click",this.handleResetClick()),this.initFilters(),this.sortItems(),null!==(t=window)&&void 0!==t&&null!==(a=t.wteL10n)&&void 0!==a&&null!==(r=a.util)&&void 0!==r&&r.on&&window.wteL10n.util.on("click",".load-more-search",this.handleLoadMore()))}sortItems(){let e=document.querySelectorAll(".category-trips-single");if(e){var t;e=Array.from(e);const a=e.filter((e=>e.classList.contains("__featured-trip"))),r=e.filter((e=>!e.classList.contains("__featured-trip")));e=[...a,...r];const n=null===(t=e[0])||void 0===t?void 0:t.parentElement;if(n){n.innerHTML="";for(let t of e)n.appendChild(t)}}}handleLoadMore(){return function(e){var t;e.preventDefault();const a=this,r=a.dataset.currentPage,n=a.dataset.maxPage,i=null===(t=document.querySelector(".wte-view-mode-selection.active"))||void 0===t?void 0:t.dataset.mode,o={action:"wte_show_ajax_result_load",query:a.dataset.queryVars,page:a.dataset.currentPage,mode:i,nonce:a.dataset.nonce},l=new FormData;for(let e in o)l.append(e,o[e]);fetch(WTEAjaxData.ajaxurl,{body:l,method:"POST"}).then((e=>e.json())).then((e=>{var t;e.success&&(jQuery(".wte-category-outer-wrap .category-main-wrap").append((null==e||null===(t=e.data)||void 0===t?void 0:t.data)||""),a.dataset.currentPage=+r+1,a.dataset.currentPage+1>=n&&a.parentElement.remove()),jQuery("#loader").fadeOut(500)}))}}fetchfilteredData(){var e;let t={action:"wte_show_ajax_result",nonce:this.component.dataset.filterNonce,mode:jQuery(".wte-view-mode-selection.active").attr("data-mode"),sort:null===(e=document.querySelector("[name=wte_orderby]"))||void 0===e?void 0:e.value};const a=new FormData;let r={};const n=this.component.querySelectorAll("input[type=radio]:checked, input[type=checkbox]:checked, .ui-slider"),i=n&&Array.from(n)||[];for(const e of i)switch(e.type||e.classList.contains("ui-slider")&&"slider"){case"checkbox":r[e.name]||(r[e.name]=[]),a.append(`result[${e.name}][]`,e.value);break;case"radio":const n="trip-chosen-date"==e.name?"date":e.name;a.append(n,e.value);break;case"number":case"text":e.value="";break;case"slider":const i=jQuery(e).slider("option","values");i&&(e.dataset.minKey&&(t[e.dataset.minKey]=i[0]),e.dataset.maxKey&&(t[e.dataset.maxKey]=i[1]))}t.result={...r};for(let e in t)"result"!==e&&a.append(e,t[e]);jQuery("#loader").fadeIn(500),fetch(wte_advanced_search.ajax_url,{method:"POST",body:a}).then((e=>e.json())).then((e=>{var t;e.success&&e.data&&(jQuery(".wte-category-outer-wrap").html((null==e||null===(t=e.data)||void 0===t?void 0:t.data)||""),jQuery(".wte-filter-foundposts .searchFoundPosts").html(e.data.foundposts),jQuery(".trip-pagination").remove()),jQuery("#loader").fadeOut(500)}))}handleFiltersChange(e){const t=this;return function(a){t.resetButton.style.removeProperty("display"),"slide"!=e&&t.fetchfilteredData()}}initFilters(){let e=this.component.querySelectorAll(".advanced-search-field");e=e&&Array.from(e);let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);for(const a of e){const e=a.querySelector(".filter-section-title"),r=a.querySelector(".filter-section-content");t?(a.classList.toggle("wte-list-opn",!1),jQuery(r).slideUp(350)):(a.classList.toggle("wte-list-opn",!0),jQuery(r).slideDown(350)),e&&e.addEventListener("click",(function(){a.classList.toggle("wte-list-opn"),r&&jQuery(r).slideToggle()}))}["change","slide","slidestop"].forEach((e=>{jQuery(this.component).on(e,this.handleFiltersChange(e))}))}handleResetClick(){const e=this;return function(t){const a=e.component.querySelectorAll("input[type=radio], input[type=checkbox], .ui-slider"),r=Array.from(a);for(const e of r)switch(e.type||e.classList.contains("ui-slider")&&"slider"){case"checkbox":case"radio":e.checked&&(e.checked=!1);break;case"number":case"text":e.value="";break;case"slider":const t=jQuery(e).slider("option");null!=t&&t.max&&(jQuery(e).slider("option","values",[t.min,t.max]),l(e)(null,{values:[t.min,t.max]}))}this.style.display="none",e.fetchfilteredData()}}}("#wte__trip-search-filters")}))}(window.jQuery),jQuery((function(e){const t=document.getElementById("wte-advanced-search-form-shortcode");if(t){const e=t.querySelectorAll('select[name="destination"], .advanced-search-field select[name="cat"], select[name="activities"], .advanced-search-field .trip-date-select');if(e)for(let t=0;t<e.length;t++)jQuery(e[t]).niceSelect()}}))})();